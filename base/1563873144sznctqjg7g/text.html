<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1. Оцифрованные сигналы с грунина в формате xxx.dat</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2. вычисление частоты по первым 100 периодам</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3. Формирование sin и cos по промежутку квантования с перемножением и получением комплексных компонент</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">4. Фурье продетектированных сигналов.<br />5. Сложение спектров</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">20.11.2019<br />Отдельно создана программа подсчёта частоты <span style=" font-weight:600;">CalcFreq</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Предполагается её использование с уже отфильтрованным с помощью FFT сигналом</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Порядок использования программ:<br />1. <span style=" font-weight:600;">FilterSignal</span> - делает FFT, вырезает окно с сильной линией, делает обратное FFT, выдает отфильтрованный сигнал</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">2.<span style=" font-weight:600;"> CalcFreq</span> - рассчитывает частоту отфильтрованного сигнала</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">3. <span style=" font-weight:600;">ZeroSpectrum </span>- детектирует исходный сигнал с  опорным сигналом на частоте, полученным с помощью</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">21.11.2019</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создана <span style=" font-weight:600;">CalcFreq.</span> Работает нормально</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">30.11.2019</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Создан комплект: </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">all</span> - объединяет в себе предыдущие <span style=" font-weight:600;">FilterSignal CalcFreq</span> и ZeroSpectrum. Работает корректно. На выходе - окно с линией, по которой рассчитывается частота и спектр с этой линией в нуле или со <span style=" font-weight:600;">сдвигом</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Входные данные: 1. Файл, 2. <span style=" font-weight:600;">Количество периодов</span>, по которым делается расчёт частоты, 3. <span style=" font-weight:600;">Cдвиг</span> (Гц) влево (для того, чтобы рассмотреть левую часть спектра)</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Перебор файлов осуществляется bash-скриптом <span style=" font-weight:600;">summ.bat</span>, в котором задается диапазон номеров файлов с сигналом</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">summ</span> - создаёт накопленный спектр</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Входные данные: 1. <span style=" font-weight:600;">Количество файлов</span>, 2. <span style=" font-weight:600;">Количество отсчётов</span> в спектре, 3. <span style=" font-weight:600;">Нормировка</span> (максимуим линии)</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Добавил <span style=" font-weight:600;">zerofilling</span> и <span style=" font-weight:600;">апподизацию</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На измерении частоты zerofilling почти не сказался (незначительно где-то во втором знаке после запятой):</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image15751267907xn9vgj4wn.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">А вот на спектре есть интересные наблюдения:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Четырехкратное добавление нулей проявило дополнительные линии на <span style=" font-weight:600;">1.5, 2, 4.75</span>, Гц от нулевой частоты</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При <span style=" font-weight:600;">сильной апподизации</span> сигнал заметно укоротился и линия уширилась. Проявившиеся линии слизались.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Разумная апподизация</span> несколько сгладила сомнительные линии. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Это при <span style=" font-weight:600;">500</span> повторениях</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575127357vitux8rdf8.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">При <span style=" font-weight:600;">5000</span> повторениях...</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">1.09.2019</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вчера выяснилось, что все эти спектры с одного скана. Просто не происходило суммирование из-за того, что внутри цикла стояло условие отслеживания максимума для нормирования и вместо &quot;==&quot; стоял один знак &quot;=&quot; и переменная цикла на первом же круге переполнялась...</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575186142y1mar6rw91.png" width="1133" height="425" /> </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Здесь сверху вниз идёт сначала увеличение количества повторений, а потом то же самое, но с 4-х кратным дополнением нулями. Видно, что 1600 - это чистовое для очень слабых линий. И ещё хорошо видно, какспектр очищается от сильной 50-герцовой помехи справа.</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Апподизацию</span> можно попробовать при 100 и 400 повторениях...</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575187950o7zap8jmk2.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Сравнение двух спектров от разных экспериментов показало, что говорить что-то о линиях 13C можно на частоте 2.75Гц и то с сомнением</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Вернулся к бензолу: при напкоплениях, сделанных на частоте резонанса обнаружились линии порядка 1:100 к основной линии с КССВ 8Гц</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575204306zonymtqdod.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">На спектрах со сдвигом частоты вправо на 50 Гц - чисто, не считая 5--герцовых гармоник:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575204788zypkza0vqq.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">к вечеру выяснилось, что не стоит делать <span style=" font-weight:600;">zerofilling</span>, видимо, сигнал смещён относительно нуля - с этим надо поработать</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image1575223668zhlk8hkhop.png" width="566" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">14.12.2019</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:22px;">Многое не писал. Стал использовать реальную составляющую спектра, которая даёт более тонкую линию. Необходимо использовать функцию, которая выравнивает фазу. </p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">В Magicplot это выглядит следующим образом: col(B)*sin(col(A)*cell(G,1)+cell(G,2))+col(C)*cos(col(A)*cell(G,1)+cell(G,2)), где col(А) - столбец с отсчётами спектра,  col(B) - столбец с Re-значениями спектра, а col(C) - с Im-значениями. В ячейках cell(G,1) и cell(G,2) лежат коэффициенты. Основным является cell(G,2), а cell(G,1) можно оставлять нулевым - это осцилляция спектра, с ней сложно работать.</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">Далее разработанный алгоритм заработал, как и следовало и были получены спектры с линиями взаимолдействия протонов с ядрами 13С:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">в бензоле:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576353645siaw04pr9z.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">в уксусной кислоте:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576353731wscq834khx.png" width="566" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576353767kxghoa7bbv.png" width="566" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">оказывается что 100 повторений вполне достаточно, но при компенсации флуктуаций</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">Апподизация синусом:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576356842mz8hkve9qj.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image15763569020i7c3gzygp.png" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">даёт очень хороший результат:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576356823mxflnwpvp5.png" width="566" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">15.12.2019</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">Идея погасить небольшие осцилляции спектра, связанные с небольшим сдвигом нуля сигнала, оказались безуспешными:</p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><img src="image1576444888zxoff5id98.png" width="1133" height="425" /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;">Спектр с точками - простое четырёхкратное дополнение нулями. Пары сверху и снизу - попытки добавить небольшие сдвиги, расчитанные как корень из интеграла всего сигнала. Близкие к спектру с точками кривые - рассчитанные сдвиги только по реальной части сигнала, а, которые подальше - по обеим частям (только сейчас дошло, что они одинаковые). Разница между верхними и нижними - вычитание или прибавление сдвига...</p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:21px;"><br /></p></body></html>