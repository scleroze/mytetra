<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p align="center" style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#5378d1;"><span style=" font-family:'Times New Roman'; font-size:x-large; font-weight:600; color:#ffffff; background-color:#5378d1;">Шаг 3 - Компиляция нескольких файлов</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><a name="aswift_0_expand"></a><span style=" font-family:'arial'; font-size:medium; color:#000000;">О</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">бычно простые программы состоят из одного исходного файла. Дело обстоит несколько сложнее, если эта программа становится большой. При работе с такой программой может возникнуть несколько достаточно серьезных проблем:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'arial'; font-size:medium; color:#000000;" style=" margin-top:12px; margin-bottom:0px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Файл, становясь большим, увеличивает время компиляции, и малейшие изменения в исходном тексте автоматически вынуждают тратить время программиста на перекомпиляцию программы.</span></li>
<li style=" font-family:'arial'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:0px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Если над программой работает много человек, то практически невозможно отследить сделанные изменения.</span></li>
<li style=" font-family:'arial'; font-size:medium; color:#000000;" style=" margin-top:0px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:medium;">Процесс правки и само ориентирование при большом исходном тексте становится сложным и поиск небольшой ошибки может повлечь за собой вынужденное &quot;изучение&quot; кода заново.</span></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Это далеко не все пробемы, которые могут возникнуть при наличии программы &quot;монстра&quot;. Поэтому при разработке программ рекомендуется их разбивать на куски, которые функционально ограничены и закончены. В этом значительно помогает сам язык </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">C++</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">, предоставляя свой богатый синтаксис.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Для того, чтобы вынести функцию или переменную в отдельный файл надо перед ней поставить зарезервированное слово </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">extern</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">. Давайте для примера создадим программу из нескольких файлов. Сначала создадим главную программу, в которой будут две внешние процедуры. Назовем этот файл </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">main.c</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">#include &lt;stdio.h&gt;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">// описываем функцию f1() как внешнюю</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">extern int f1();</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">// описываем функцию f2() как внешнюю</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">extern int f2();</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">int main()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">{</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	int n1, n2;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	n1 = f1();</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	n2 = f2();</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	printf(&quot;f1() = %d\n&quot;,n1);</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	printf(&quot;f2() = %d\n&quot;,n2);</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	return 0;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">}</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Теперь создаем два файла, каждый из которых будет содержать полное определение внешней функции из главной программы. Файлы назовем </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">f1.c</span><span style=" font-family:'arial'; font-size:medium; color:#000000;"> и </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">f2.c</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">// файл f1.c</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">int f1()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">{</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	return 2;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">}</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px; font-family:'monospace'; font-size:medium; color:#0000ff;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">// файл f2.c</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">int f2()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">{</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	return 10;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">}</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">После этого процесс компиляции программы с помощью </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">gcc</span><span style=" font-family:'arial'; font-size:medium; color:#000000;"> будет выглядеть несколько иначе от описанного в </span><a href="http://www.firststeps.ru/linux/r.php?1"><span style=" font-family:'arial'; font-size:medium; text-decoration: underline; color:#0000ff;">&quot;Шаг 1 - Компиляция программ на языке C/C++&quot;</span></a><span style=" font-family:'arial'; font-size:medium; color:#000000;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Компилировать можно все файлы одновременно одной командой, перечисляя составные файлы через пробел после ключа </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">-c</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">gcc -c main.c f1.c f2.c</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Или каждый файл в отдельности:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">gcc -c f1.c</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">gcc -c f2.c</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">gcc -c main.c</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">В результате работы компилятора мы получим три отдельных объектных файла:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">main.o</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">f1.o</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">f2.o</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Чтобы их собрать в один файл с помощью </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">gcc</span><span style=" font-family:'arial'; font-size:medium; color:#000000;"> надо использовать ключ </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">-o</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">, при этом линкер соберет все файлы в один:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">gcc main.o f1.o f2.o -o rezult</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">В результате вызова полученной программы </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">rezult</span><span style=" font-family:'arial'; font-size:medium; color:#000000;"> командой:</span></p>
<pre style=" margin-top:12px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">./rezult</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">На экране появится результат работы:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~# ./rezult</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">f1() = 2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">f2() = 10</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~#</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Теперь, если мы изменим какую-то из процедур, например </span><span style=" font-family:'arial'; font-size:medium; font-weight:600; color:#000000;">f1()</span><span style=" font-family:'arial'; font-size:medium; color:#000000;">:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">int f1()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">{</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">	return 25;</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">}</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">То компилировать заново все файлы не придется, а понадобится лишь скомпилировать измененный файл и собрать результирующий файл из кусков:</span></p>
<pre style=" margin-top:12px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~# gcc -c f1.c</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~# gcc main.o f1.o f2.o -o rezult2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~# ./rezult2</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">f1() = 25</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#008000;">f2() = 10</span></pre>
<pre style=" margin-top:0px; margin-bottom:12px; margin-left:55px; margin-right:10px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'monospace'; font-size:medium; color:#0000ff;">dron:~#</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:24px; margin-right:24px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'arial'; font-size:medium; color:#000000;">Таким образом можно создавать большие проекты, которые больше не будут отнимать много времени на компиляцию и поиск ошибок. Однако помните, не стоит также черезчур разбивать программу, иначе у Вас получится несколько десятков файлов, в которых Вы сами рано или поздно запутаетесь. Найдите &quot;золотую середину&quot;, например в отдельные файлы помещайте те функции или классы, с которыми Вам приходится больше всего работать при отладке. После того, как функция будет окончательно отлажена, ее вполне можно перенести в более крупный файл.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"> </p></body></html>