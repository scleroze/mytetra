<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://alex-exe.ru/radio/stm32/connect-sd-card-stm32-spi/"><span style=" text-decoration: underline; color:#0000ff;">Здесь оригинал</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Если в проекте нужно выводить или получать большие объемы данных то на помощь придут различные flash микросхемы памяти. Если же нежно получать или выводить ОГРОМНЫЕ объемы данных, то стоит задуматься о более вместительном хранилище информации. На роль такого вместилища подходит SD карта памяти. Это – огромный носитель информации, по сравнению с обычными микросхемами памяти, объём которых редко превышает 64Мбита.</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><img src="image1561474417t7cdtxif2r.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Подключение SD карты к STM32vlDiscovery</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В статье рассмотрим подключение и диалог SD карты памяти с микроконтроллером STM32, через SPI. Без использование файловой системы.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><a name="more-2081"></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;"> качестве контроллера и платы выступит демонстрационная плата STM32vlDiscovery с контроллером STM32F100RB на борту. Диалог с платой будет производиться по UART, точнее, через</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> </span><a href="https://alex-exe.ru/radio/interfacingpc/usb-uart-cp2102/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">преобразователь USB-UART</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> будем общаться через COM терминальную программу </span><a href="https://alex-exe.ru/programm/al-terminal/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">AL Terminal</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">. Связь с картой памяти будет осуществляться через SPI.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Подключение карты памяти к STM32F100RB установленному в Discovery будет выглядеть следующим образом:</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><img src="image1561474417c111ilf67u.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Схема</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Контроллер установлен на демонстрационной плате и его подключение расписывать не буду. Преобразователь USB-UART описан в статье —</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> </span><a href="https://alex-exe.ru/radio/interfacingpc/usb-uart-cp2102/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">USB-UART на cp2102</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> , можете применить и любой другой, например </span><a href="https://alex-exe.ru/radio/interfacingpc/ft232rl/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">ft232</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> . Карта памяти подключается напрямую к микроконтроллеру, т.к. напряжение питание и логические уровни сигналов, в 3.3В, у них одинаковые.</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><img src="image1561474417jz7q5fbgeq.png" /></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Распиновка SD карты в SPI режиме</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">С подключением ничего сложного нет, переходим к коду.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Проект написан в Keil с использованием CMSIS и Standard Peripheral Library. Из SPL применены GPIO, RCC И USART библиотеки. Библиотеку для работы с картой памяти воспользовался готовой, взял с сайта «My Controller» —</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> </span><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> .</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Возможности библиотеки:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SD_init()</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – инициализация SPI и карты памяти<br />в случае удачи возвращает 0.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SD_sendCommand(cmd, arg)</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – посылка команды SD карте<br />Где: </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">cmd</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – команда, </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">arg</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – аргумент<br />Основные команды:<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">GO_IDLE_STATE 0</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – программная перезагрузка<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SEND_IF_COND 8</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – для SDC V2 — проверка диапазона напряжений<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">READ_SINGLE_BLOCK 17</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – чтение указанного блока данных<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">WRITE_SINGLE_BLOCK 24</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – запись указанного блока данных<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SD_SEND_OP_COND 41</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – начало процесса инициализации<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">APP_CMD 55</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – главная команда из ACMD команд<br /></span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">READ_OCR 58</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – чтение регистра OCR<br />Команд для работы с картой памяти на самом деле гораздо больше, но в библиотеки задействованы только эти, чего для минимальной работы достаточно.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SD_ReadSector(BlockNumb,*buff)</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – прочитать сектор<br />в случае неудачи возвращает 0<br />Где: </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">BlockNumb</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – адрес блока карты памяти, </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">*buff</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – ссылка для буфера</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">SD_WriteSector(BlockNumb,*buff)</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – записать сектор<br />в случае неудачи возвращает 0<br />Где: </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">BlockNumb</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – адрес блока карты памяти, </span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; font-weight:600; color:#444444;">*buff</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> – ссылка для буфера</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">На основе библиотеки написал небольшую оболочку для ознакомления с картой памяти:</span></p>
<p style=" margin-top:13px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#f8f8f8;"><a name="highlighter_499229"></a><a href="https://alex-exe.ru/radio/stm32/connect-sd-card-stm32-spi/#viewSource"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#a0a0a0;">v</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#a0a0a0;">iew source</span><a href="https://alex-exe.ru/radio/stm32/connect-sd-card-stm32-spi/#printSource"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#a0a0a0;">print</span></a><a href="https://alex-exe.ru/radio/stm32/connect-sd-card-stm32-spi/#about"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#a0a0a0;">?</span></a></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">01.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">unsigned </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#808080; background-color:#ffffff;">long</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;"> address,i;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">02.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">unsigned </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#808080; background-color:#f8f8f8;">char</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;"> c;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">03.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">04.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">init();                                         </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  инициализация переферии</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">05.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">if</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">(SD_init()==0)                                </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  инициализация SD карты памяти</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">06.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">07.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;init sd ok\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">08.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">09.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">10.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">11.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;init sd fail\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">12.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">13.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;"> </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">14.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">&quot;alex-exe.ru&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);            </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  выводим сообщение в UART</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">15.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">while</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">(1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">16.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">17.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;\n----------------------------\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">18.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">&quot;Read or write sd card r/w = &quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">19.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">c=getch_Uart(USART1);                       </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  читаем байт с uart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">20.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#f8f8f8;">while</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">(getch_Uart(USART1)!=13){}             </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  дожидаемся ввода enter с uart</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">21.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;\nPress enter address = &quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">22.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">buff_clear();                               </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  очистка буфера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">23.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">address=read_int_uart(USART1);              </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  читаем число с uart, адрес сектора на sd карте</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">24.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">&quot;\nAddress = &quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">25.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_int_Uart(USART1,address);              </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  выводим для проверки введенное число   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">26.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">'\n'</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">27.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">if</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">(c==</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">'w'</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">)                                  </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  проверка на запись или чтение карты памяти</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">28.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">29.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;Press enter data blok (max 512B), to exit press enter\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">30.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">read_str_uart(USART1,Buff);             </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  читаем строку с uart, окончание enter</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">31.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">i=0;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">32.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#f8f8f8;">while</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">((i &lt; 512)&amp;&amp;(Buff[i]!=0))i++;       </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  ищем конец текстовой строки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">33.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;Length text data = &quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">34.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_int_Uart(USART1,i);                </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  выводим длину текстового послания</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">35.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">'\n'</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">36.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#f8f8f8;">if</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">(SD_WriteSector(address, Buff)==0)    </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  запись буфера на SD карту</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">37.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">38.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">&quot;write sd ok\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">39.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">40.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#f8f8f8;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">41.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">42.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#f8f8f8;">&quot;write sd fail\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">43.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">44.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">45.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">46.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">47.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">if</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">(SD_ReadSector(address, Buff)==0) </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  чтения SD карты в буфер</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">48.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">49.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;read sd ok\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">50.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">51.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">else</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">52.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">53.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart_str(USART1,</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#0000ff; background-color:#ffffff;">&quot;read sd fail\n&quot;</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">54.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">55.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; font-weight:600; color:#006699; background-color:#ffffff;">for</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">(i=0;i &lt; 512;i++)             </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  вывод содержимого буфера в терминал</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">56.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">{</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">57.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">send_Uart(USART1,Buff[i]);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">58.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">59.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">60.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#f8f8f8;">//  на последок мигнём светодиодом</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">61.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">GPIO_SetBits(GPIOC, GPIO_Pin_8);    </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  включить синий светодиод на PC8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">62.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">delay(1000000);</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">63.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#ffffff;">GPIO_ResetBits(GPIOC, GPIO_Pin_8);  </span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#008200; background-color:#ffffff;">//  выключить синий светодиод на  PC8</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#5c5c5c;">64.</span><span style=" font-family:'Consolas,Monaco,Bitstream Vera Sans Mono,Courier New,Courier,monospace'; font-size:8.25pt; color:#000000; background-color:#f8f8f8;">}</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В коде реализована возможность чтения и записи блоков карты памяти через</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> </span><a href="https://alex-exe.ru/programm/al-terminal/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">терминал</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">Эксперименты проводил с картами памяти SD Transcend 2 GB и SDHC Qumo 8GB.</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><a href="https://alex-exe.ru/files/source/stm32-sd+uart.rar"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">Скачать исходник</span></a></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:24px; background-color:#ffffff;"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444; background-color:#ffffff;">В статье использовались материалы с сайта «My Controller» —</span><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;"> </span><a href="http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/"><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; text-decoration: underline; color:#cc0000;">http://mycontroller.ru/category/vneshnie-ustroystva/karta-pamyati-sd/</span></a><span style=" font-family:'Verdana,Trebuchet MS,Arial,Helvetica,sans-serif'; font-size:8.25pt; color:#444444;">.</span></p></body></html>